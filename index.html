<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì§€í•˜ì²  ë„ì°© ì•Œë¦¼</title>
</head>
<body>
  <h1>ğŸš‡ ì‹¤ì‹œê°„ ì§€í•˜ì²  ë„ì°© ì•Œë¦¼</h1>

  <label for="stationInput">ë„ì°© ì•Œë¦¼ì„ ë°›ì„ ì—­ ì´ë¦„ ì…ë ¥:</label>
  <input type="text" id="stationInput" placeholder="ì˜ˆ: ì‹ ë„ë¦¼">
  <button onclick="startMonitoring()">ì•Œë¦¼ ì‹œì‘</button>

  <p id="status"></p>

  <h2>ğŸ“ í˜„ì¬ ì—´ì°¨ ìœ„ì¹˜</h2>
  <ul id="stationList" style="line-height: 2; font-size: 18px; list-style: none; padding-left: 0;"></ul>

  <script>
    let targetStation = "";
    let alarmed = false;

    // ì•ŒëŒ ì†Œë¦¬ ë¯¸ë¦¬ ìƒì„±
    const alarmSound = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');
// ë˜ëŠ” MP3
// const alarmSound = new Audio('https://www.soundjay.com/button/sounds/beep-07.mp3');

    alarmSound.volume = 1.0;

    // í‘œì‹œí•  1í˜¸ì„  ì£¼ìš”ì—­ ë¦¬ìŠ¤íŠ¸ (ì›í•˜ì‹œë©´ ë” ì¶”ê°€ ê°€ëŠ¥)
    const stationNames = ["ì„œìš¸ì—­", "ì‹œì²­", "ì¢…ê°", "ì¢…ë¡œ3ê°€", "ì¢…ë¡œ5ê°€", "ë™ëŒ€ë¬¸", "íšŒê¸°", "ì²­ëŸ‰ë¦¬"];

    async function fetchSubwayData() {
      const API_KEY = "4c4265476973796737364a51757a47"; // ë³¸ì¸ í‚¤ ì‚¬ìš©
      const URL = `http://swopenAPI.seoul.go.kr/api/subway/4c4265476973796737364a51757a47/json/realtimePosition/0/5/1í˜¸ì„ `;

      try {
        const res = await fetch(URL);
        const data = await res.json();

        if (data.realtimePositionList) {
          const trainList = data.realtimePositionList;
          document.getElementById("status").innerText =
            `ì‹¤ì‹œê°„ ì—´ì°¨ ìˆ˜: ${trainList.length}`;

          // ì½˜ì†”ì— ì—´ì°¨ ìœ„ì¹˜ ì¶œë ¥
          for (let train of trainList) {
            console.log(`ğŸš‡ [ì—´ì°¨] í˜„ì¬ì—­: ${train.statnNm}, ìƒíƒœ: ${train.trainSttus}, ë°©ë©´: ${train.statnTnm}`);
          }

          // í˜„ì¬ ì—´ì°¨ ìœ„ì¹˜ ëª©ë¡ í‘œì‹œ
          updateStationList(trainList);

          // ë„ì°© ì•Œë¦¼ ì¡°ê±´ ê²€ì‚¬
          for (let train of trainList) {
            if (
              train.statnNm === targetStation &&
              (train.trainSttus === "0" || train.trainSttus === "1")
            ) {
              if (!alarmed) {
                alert(`ğŸš¨ ì—´ì°¨ê°€ "${targetStation}"ì—­ì— ë„ì°©í•˜ê±°ë‚˜ ì§„ì… ì¤‘ì…ë‹ˆë‹¤!`);
                alarmSound.currentTime = 0;
                alarmSound.play().catch(err => {
                  console.warn("ğŸ”‡ ì•ŒëŒ ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:", err);
                });
                alarmed = true;
              }
              break;
            }
          }
        } else {
          document.getElementById("status").innerText = "ì—´ì°¨ ì •ë³´ ì—†ìŒ";
        }
      } catch (e) {
        console.error("API í˜¸ì¶œ ì˜¤ë¥˜:", e);
        document.getElementById("status").innerText = "API ì˜¤ë¥˜ ë°œìƒ";
      }
    }

    function updateStationList(trainList) {
      const ul = document.getElementById("stationList");
      ul.innerHTML = ""; // ì´ˆê¸°í™”

      for (const station of stationNames) {
        const isTrainHere = trainList.some(train =>
          train.statnNm === station &&
          (train.trainSttus === "0" || train.trainSttus === "1")
        );

        const li = document.createElement("li");
        li.textContent = isTrainHere ? `ğŸš‡ ${station}` : `â–«ï¸ ${station}`;
        ul.appendChild(li);
      }
    }

    function startMonitoring() {
      targetStation = document.getElementById("stationInput").value.trim();
      if (!targetStation) {
        alert("ì—­ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }

      alarmed = false;
      fetchSubwayData(); // ì²« ì‹¤í–‰
      setInterval(fetchSubwayData, 10000); // 10ì´ˆë§ˆë‹¤ ê°±ì‹ 
    }
  </script>
</body>
</html>
